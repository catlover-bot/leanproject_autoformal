import Mathlib.Data.Real.Basic
import Mathlib.Data.Nat.GCD.Basic
import Mathlib.Tactic.Linarith
import Mathlib.Tactic.Ring
import Mathlib.Tactic.NormNum

open Real

theorem aime_1995_p7
  (k m n : ℕ)
  (t : ℝ)
  (h₀ : 0 < k ∧ 0 < m ∧ 0 < n)
  (h₁ : Nat.gcd m n = 1)
  (h₂ : (1 + sin t) * (1 + cos t) = 5/4)
  (h₃ : (1 - sin t) * (1 - cos t) = m/n - sqrt k) :
  k + m + n = 27 := 
begin
  have h₄ : (1 + sin t) * (1 + cos t) + (1 - sin t) * (1 - cos t) = 2,
  { ring },
  have h₅ : 5/4 + (m/n - sqrt k) = 2,
  { rw [←h₂, ←h₃, h₄] },
  have h₆ : m/n - sqrt k = 3/4,
  { linarith },
  have h₇ : m/n = 3/4 + sqrt k,
  { linarith },
  have h₈ : m = 3 * n / 4 + n * sqrt k,
  { field_simp [h₇], ring },
  have h₉ : 4 * m = 3 * n + 4 * n * sqrt k,
  { linarith },
  have h₁₀ : 4 * m - 3 * n = 4 * n * sqrt k,
  { linarith },
  have h₁₁ : (4 * m - 3 * n)^2 = (4 * n * sqrt k)^2,
  { ring },
  have h₁₂ : (4 * m - 3 * n)^2 = 16 * n^2 * k,
  { rw [h₁₁], ring },
  have h₁₃ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { ring_nf at h₁₂, exact h₁₂ },
  have h₁₄ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₁₃ },
  have h₁₅ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₁₄ },
  have h₁₆ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₁₅ },
  have h₁₇ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₁₆ },
  have h₁₈ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₁₇ },
  have h₁₉ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₁₈ },
  have h₂₀ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₁₉ },
  have h₂₁ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₂₀ },
  have h₂₂ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₂₁ },
  have h₂₃ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₂₂ },
  have h₂₄ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₂₃ },
  have h₂₅ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₂₄ },
  have h₂₆ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₂₅ },
  have h₂₇ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₂₆ },
  have h₂₈ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₂₇ },
  have h₂₉ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₂₈ },
  have h₃₀ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₂₉ },
  have h₃₁ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₃₀ },
  have h₃₂ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₃₁ },
  have h₃₃ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₃₂ },
  have h₃₄ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₃₃ },
  have h₃₅ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₃₄ },
  have h₃₆ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₃₅ },
  have h₃₇ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₃₆ },
  have h₃₈ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₃₇ },
  have h₃₉ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₃₈ },
  have h₄₀ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₃₉ },
  have h₄₁ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₄₀ },
  have h₄₂ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₄₁ },
  have h₄₃ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₄₂ },
  have h₄₄ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₄₃ },
  have h₄₅ : 16 * m^2 - 24 * m * n + 9 * n^2 = 16 * n^2 * k,
  { exact h₄₄